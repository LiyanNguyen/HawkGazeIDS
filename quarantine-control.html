<!DOCTYPE html>
<html>
<head>
	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<!-- Page Title -->
	<title>Quarantine Control</title>

	<!-- Bootstrap CSS CDN v5.0.1-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

	<!-- Animate on Scroll CSS -->
	<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

	<!-- Our Project CSS -->
	<link rel="stylesheet" href="project.css">

	<!-- Sidebar Scrollbar CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

	<!-- Font Awesome JS -->
	<script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js"></script>
</head>
<body>
	<!--Main Layer -->
	<div class="container">
		<!-- Sidebar  navigation-->
		<nav id="sidebar">
			<div id="dismiss" onclick="CloseSidebar()">
				<i class="fas fa-arrow-left"></i>
			</div>
			<!-- Sidebar header -->
			<div class="sidebar-header">
				<div class="d-flex justify-content-center">
					<img src="HawkIDS_small.jpg" class="img-fluid" width="125" height="125">
				</div>
				<br>
				<h3 class="d-flex justify-content-center">Hawk IDS</h3>
			</div>
			<hr class="solid m-0">

			<!-- Sidebar options list -->
			<ul class="list-unstyled components">
				<li>
					<a onclick='passSession("live-network-traffic.html")'><i class="far fa-clock"></i> Live Network Traffic</a>
				</li>
				<li>
					<a onclick='passSession("historical-network-data.html")'><i class="fas fa-history"></i> Historical Network Data</a>
				</li>
				<li class="active">
					<a onclick='passSession("quarantine-control.html")'><i class="fas fa-shield-alt"></i> Quarantine Control</a>
				</li>
				<li>
					<a onclick='passSession("notification-settings.html")'><i class="fas fa-bell"></i> Notification Settings</a>
				</li>
				<!-- line on the side bar to seperate logout -->
				<hr class="solid">
				<li>
					<a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
				</li>
			</ul>
		</nav>

		<!-- Page Content (excluding sidebar, all other page content should be under here) -->
		<div id="content" class="container-fluid">
			<!-- Navigation Row -->
			<div class="row sticky-top">
				<!-- Header Navigation-->
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<!-- Sidebar collapse button-->
					<button type="button" id="sidebarCollapse" class="btn btn-primary" onclick="OpenSidebar()"><i class="fas fa-bars"></i></button>
					<div class="col py-1">
						<h5 align="center">Quarantine Control&emsp;&ensp;</h5>
					</div>
				</nav>
			</div>
			<br>

			<!-- Page Information Row -->
			<div class="alert alert-light alert-dismissible fade show rounded-3 shadow mx-1 mb-3" role="alert">
				<strong><i class="far fa-question-circle"></i> Page Information</strong><hr>This page allows you to manage the network rules that controls the flow of traffic coming into the network. you can view, create, and examine these rules to further specify which network traffic to isolate and keep an eye on.
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<!-- Quarantine Control Overview Row -->
			<div class="card rounded-3 border-3 shadow row mx-1 mb-3" data-aos="fade-right">
				<h6 class="card-header">
					<i class="fas fa-shield-alt"></i> Quarantine Control Overview
				</h6>
				<div class="card-body">
					<span class="badge bg-primary fs-6 mb-2">Quarantine Rules:</span> <span id="amount-of-rules">#</span>
					<br>
					<span class="badge bg-info fs-6 mb-2">Traffic Quaratined:</span><span id="amount-of-quarantine">#</span>
					<hr>
					Quaratining Status
					<hr>
					<!-- Good badge to show when overall status is good -->
					<div id="Good" style="display:none;">
						<span class="badge bg-success fs-6"><i class="fas fa-check"></i> Good</span>
						<br>
						<p>No potential network intrusion entered the network</p>
						<hr>
					</div>

					<!-- Warning badge to show when overall status is in medium priority -->
					<div id="Warning" style="display:none;">
						<span class="badge bg-warning fs-6"><i class="fas fa-exclamation-triangle"></i> Warning!</span>
						<br>
						<p>Some potential network intrusion has entered the network</p>
						<hr>
					</div>

					<!-- Danger badge to show when overall status is in high priority -->
					<div id="Danger" style="display:none;">
					<span class="badge bg-danger fs-6"><i class="fas fa-skull-crossbones"></i> Danger!</span>
					<br>
					<p>Some high risk network intrusion has entered the network</p>
					</div>
				</div>
			</div>

			<!-- Quarantine Rules Row -->
			<div class="card rounded-3 border-3 shadow row mx-1 mb-3" data-aos="fade-right">
				<h6 class="card-header">
					<i class="fas fa-tasks"></i> Quarantine Rules
				</h6>
				<div class="card-body">
					<div class="row">
						<div class="col-3">
							<a tabindex="0" class="btn btn-primary btn-sm mb-3" role="button" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="right" data-bs-content="You can create, update and delete the quarantine rules here. The current existing rules will also appear here. You can delete or modify existing rules to suit your needs. Take a look at quarantine rules guide on the next panel below on how to manage these rules."><i class="fas fa-question"></i></a>
						</div>
					</div>
					<!-- Accordion containing the existing quarantine conditions -->
					<div class="accordion" id="quarantineAccordion">
						<!-- 1st accordion sample item -->
						<div class="accordion-item">
							<h2 class="accordion-header" id="quarantine-accordion-sample">
								<button id="quarantine-name-on-header" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSample">(Sample) Quarantine Name</button>
							</h2>
							<div id="collapseSample" class="accordion-collapse collapse show" data-bs-parent="#quarantineAccordion">
								<div class="accordion-body">
									<div class="row">
										<p id="ruleSample">quarantine rules will appear here... this sample will be deleted and pull the ones in the server side once connected to the back-end</p>
									</div>
									<div class="row">
										<p><span class="badge bg-primary">Date Created:</span> <small id="quarantine-date-created">XX-XX-XXXX</small></p>
										<p><span class="badge bg-secondary">Date Last Modified:</span> <small id="quarantine-date-last-modified">XX-XX-XXXX</small> </p>
										<!-- Edit and Delete action buttons -->
										<ul class="list-inline">
											<li class="list-inline-item">
												<button class="btn btn-success btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#editSelectedQuarantineCondition">Edit <i class="fa fa-edit"></i></button>
											</li>
											<li class="list-inline-item">
												<button class="btn btn-danger btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#deleteSelectedQuarantineCondition">Delete <i class="fa fa-trash"></i></button>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div><!-- End  of accordion-item <div> -->	
					</div><!-- End of accordion <div> -->
					<button class="btn btn-info col-12" data-bs-toggle="modal" data-bs-target="#createNewQuarantineModal"><i class="fas fa-plus"></i> Create New Condition</button>
				</div>
			</div>

			<!-- Quarantine Rules Guide Row -->
			<div class="card rounded-3 border-3 shadow row mx-1 mb-3" data-aos="fade-right" id="quarantine-rules-guide">
				<h6 class="card-header">
					<i class="fas fa-book"></i> Quarantine Rules Guide
				</h6>
				<div class="card-body">
					<div class="row">
						<p class="fw-lighter fst-italic">For more detailed information on how to create rules, you can look at the manual <u><a href="http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node29.html">here</a></u></p>
						<p class="fw-lighter fst-italic">or you can use the sample rules below for a quick start (All sid up to 1,000,000 are reserved. So your sid must be at least 1000001.)</p>
						<hr>
						<i class="fw-lighter">sample rule to log tcp</i>
						<code class="fs-6">alert tcp any any -> any any (msg:"uncategorized traffic";sid:11111111;rev:1;priority:0;)</code>
						<hr>
						<i class="fw-lighter">sample rule to log udp</i>
						<code class="fs-6">alert udp any any -> any any (msg:"uncategorized traffic";sid:11111112;rev:1;priority:0;)</code>
						<hr>
						<i class="fw-lighter">sample rule to log icmp</i>
						<code class="fs-6">alert icmp any any -> any any (msg:"uncategorized traffic";sid:11111113;rev:1;priority:0;)</code>
						<hr>
						<i class="fw-lighter">sample rule to detect SQL injection</i>
						<code class="fs-6">alert tcp any any -> $HOME_NET any (msg:"SQL Injection Attempt";content:"or '1'='1'";sid:8059;rev:1;priority:3;)</code>
						<hr>
						<i class="fw-lighter">sample rule to detect suspicious login</i>
						<code class="fs-6">alert tcp any any -> $HOME_NET any (msg:"Brute Force Login Attempt";content:"password";nocase;detection_filter:track by_src, count 5, seconds 60;sid:19559; rev:1;priority:5;)</code>
						<hr>
					</div>
				</div>
			</div>

			<!-- Create New Quarantine Condition Modal -->
			<div class="modal fade" id="createNewQuarantineModal" tabindex="-1">
				<!-- Vertically centered modal -->
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<!-- Modal header content -->
						<div class="modal-header alert alert-primary">
							<h5 class="modal-title"><i class="fas fa-plus-square"></i> Create Quarantine Condition</h5>
							<!-- (X) close button on the right side of header -->
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<!-- Modal body content -->
						<div class="modal-body">
							<div class="col">
								<label for="QuarantineName" class="form-label">Quarantine Name</label>
								<input type="text" class="form-control" id="QuarantineName">
								<label for="create-rule" class="form-label">Quaratine Rules</label>
								<input type="text" class="form-control" id="create-rule"></input>
							</div>
						</div>
						<!-- Modal footer content -->
						<div class="modal-footer">
							<!-- Cancel button on modal footer's bottom left side -->
							<button type="button" class="btn btn-secondary col" data-bs-dismiss="modal">Cancel</button>
							<!-- Create button on modal footer's bottom right side -->
							<button type="button" class="btn btn-primary col" data-bs-dismiss="modal" onclick="create()">Create</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Edit Quarantine Condition Modal -->
			<div class="modal fade" id="editSelectedQuarantineCondition" tabindex="-1">
				<!-- Vertically centered modal -->
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<!-- Modal header content -->
						<div class="modal-header alert alert-info">
							<h5 class="modal-title"><i class="fas fa-edit"></i> Edit Quarantine Condition</h5>
							<!-- (X) close button on the right side of header -->
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<!-- Modal body content -->
						<div class="modal-body">
							<div class="col">
								<label for="edit-quarantine-name" class="form-label">Edit Name</label>
								<input type="text" class="form-control" id="edit-quarantine-name"></input>
								<label for="edit-rule" class="form-label">Edit Rules</label>
								<input type="text" class="form-control" id="edit-rule"></input>
							</div>
						</div>
						<!-- Modal footer content -->
						<div class="modal-footer">
							<!-- Cancel button on modal footer's bottom left side -->
							<button type="button" class="btn btn-secondary col" data-bs-dismiss="modal">Cancel</button>
							<!-- Create button on modal footer's bottom right side -->
							<button type="button" class="btn btn-info col" data-bs-dismiss="modal" onclick="edit()">Apply Changes</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Delete Quarantine Condition Modal -->
			<div class="modal fade" id="deleteSelectedQuarantineCondition" tabindex="-1">
				<!-- Vertically centered modal -->
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<!-- Modal header content -->
						<div class="modal-header alert alert-danger">
							<h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Delete Quarantine Condition</h5>
							<!-- (X) close button on the right side of header -->
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<!-- Modal body content -->
						<div class="modal-body">
							<h5>This action cannot be undone.</h5>
							<p>Are you sure you want to delete: <strong id="q_name">#Quarantine_Name</strong></p>
						</div>
						<!-- Modal footer content -->
						<div class="modal-footer">
							<!-- Cancel button on modal footer's bottom left side -->
							<button type="button" class="btn btn-secondary col" data-bs-dismiss="modal">Cancel</button>
							<!-- Create button on modal footer's bottom right side -->
							<button type="button" class="btn btn-danger col" data-bs-dismiss="modal" onclick="remove()">Delete</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Toast Error Message -->
			<!-- z-index: 1100, so that it will appear on top of the modal -->
			<div class=" toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
				<div id="liveToast" class="toast hide" role="alert">
					<div class="toast-header bg-warning">
						<i class="fas fa-exclamation-triangle"></i>
						<strong class="me-auto"> Warning!</strong>
						<small class="text-muted">just now</small>
						<button type="button" class="btn-close" data-bs-dismiss="toast"></button>
					</div>
					<div class="toast-body" id="toast-body-error-message"></div>
				</div>
			</div>

		</div><!-- End of content <div> -->
	</div><!-- End of .container <div> -->

	<!-- Overlay layer-->
	<div class="overlay" onclick="CloseSidebar()"></div>

	<!-- AJAX v3.5.1-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!-- Bootstrap JS including Popper JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

	<!-- jQuery Custom Scroller CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

	<!-- Script to control sidebar -->
	<script type="text/javascript" src="Sidebar.js"></script>

	<!-- Animate on Scroll JS -->
	<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

	<!-- Initialize animte on scroll external JS -->
	<script>AOS.init();</script>
	
	<!-- Script for request functions -->
	<script type="text/javascript" src="function.js"></script>

	<!-- Bootstrap Popover Script -->
	<script type="text/javascript" src="Popover.js"></script>
	
	<!--UI and Controller Interaction Script-->
	<script>
	var num;
	
	function setNum(i)
	{
		num = i;
		document.getElementById("q_name").innerHTML = $("#quarantine-name-on-header" + num).text();
	}
	
	function create()
	{
		var data = JSON.stringify({"request":"createQuarantine","rule":document.getElementById("create-rule").value,"name":document.getElementById("QuarantineName").value});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/ids-system.exe',
			data: data,
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {
					alert(returnedData);
					display();
				}
			},
			error: function (msg) {
				$('.toast').toast('show');
				document.getElementById("toast-body-error-message").innerHTML = "access failed：" + msg;
			}
		});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/restart.exe',
			data: "restart",
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {

				}
			},
			error: function (msg) {
				
			}
		});
	}
	
	function display()
	{
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/ids-system.exe',
			data: JSON.stringify({"request":"getQuarantine"}),
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {
					if(returnedData == "quarantine parameters currently cannot be shown")
					{
						alert(returnedData);
					}
					else
						document.getElementById("quarantineAccordion").innerHTML = returnedData;
				}
			},
			error: function (msg) {
				//alert("access failed：" + msg);
				$('.toast').toast('show');
				document.getElementById("toast-body-error-message").innerHTML = "access failed：" + msg;
			}
		});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/ids-system.exe',
			data: '{"request":"quarantine overview"}',
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {
					var obj = JSON.parse(returnedData);
					document.getElementById("amount-of-rules").innerHTML = obj.amountOfRules;
					document.getElementById("amount-of-quarantine").innerHTML = obj.amountOfQuarantined;
					if(obj.quarantineStatus >= 5)
						document.getElementById("Danger").style.display = "block";
					else if(obj.quarantineStatus >= 1 && obj.quarantineStatus < 5)
						document.getElementById("Warning").style.display = "block";
					else
						document.getElementById("Good").style.display = "block";
				}
			},
			error: function (msg) {
				//alert("access failed：" + msg);
				$('.toast').toast('show');
				document.getElementById("toast-body-error-message").innerHTML = "access failed：" + msg;
			}
		});
	}
	
	function edit()
	{
		var old_rule = $("#rule" + num).text();
		var new_rule = document.getElementById("edit-rule").value;
		var new_name = document.getElementById("edit-quarantine-name").value;
		var data = JSON.stringify({"request":"editQuarantine","old":old_rule,"new":new_rule,"name":new_name});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/ids-system.exe',
			data: data,
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {
					alert(returnedData);
					display();
				}
			},
			error: function (msg) {
				//alert("access failed：" + msg);
				$('.toast').toast('show');
				document.getElementById("toast-body-error-message").innerHTML = "access failed：" + msg;
			}
		});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/restart.exe',
			data: "restart",
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {

				}
			},
			error: function (msg) {

			}
		});
	}
	
	function remove()
	{
		var data = JSON.stringify({"request":"deleteQuarantine","rule":$("#rule" + num).text()});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/ids-system.exe',
			data: data,
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {
					alert(returnedData);
					display();
				}
			},
			error: function (msg) {
				$('.toast').toast('show');
				document.getElementById("toast-body-error-message").innerHTML = "access failed：" + msg;
			}
		});
		
		$.ajax({
			type: 'POST',
			url: '../cgi-bin/restart.exe',
			data: "restart",
			dataType: 'text',
			ContentType: 'application/text; charset=utf-8',
			success: function (returnedData, status) {
				if (status == "success") {

				}
			},
			error: function (msg) {
			
			}
		});
	}
	
	$(document).ready(function(){
		display();
	})
	</script>
</body>
</html>